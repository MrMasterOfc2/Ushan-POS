<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHANDANA STORES - PRO POS</title>
    <style>
        /* --- 1. ‡∂∏‡∑ù‡∑É‡∑ä‡∂≠‡∂ª (CSS) --- */
        :root {
            --main-blue: #1a237e;
            --success-green: #2e7d32;
            --error-red: #c62828;
            --light-gray: #f5f6fa;
            --text-primary: #000000;
            --bg-primary: #ffffff;
            --bg-secondary: #f5f6fa;
            --border-color: #ddd;
            --shadow: rgba(0,0,0,0.1);
        }

        .dark-mode {
            --main-blue: #3949ab;
            --success-green: #4caf50;
            --error-red: #ef5350;
            --light-gray: #1e1e1e;
            --text-primary: #ffffff;
            --bg-primary: #121212;
            --bg-secondary: #1e1e1e;
            --border-color: #333;
            --shadow: rgba(255,255,255,0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
        }

        header {
            background: var(--main-blue);
            color: white;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .main-wrapper {
            display: flex;
            flex: 1;
            overflow: hidden;
            padding: 10px;
            gap: 15px;
        }

        .inventory-section {
            flex: 2;
            background: var(--bg-primary);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            padding: 15px;
            border: 1px solid var(--border-color);
        }

        .billing-section {
            flex: 1;
            background: var(--bg-primary);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            padding: 15px;
            border-left: 5px solid var(--main-blue);
            min-width: 320px;
        }

        .search-bar {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: var(--bg-primary);
            color: var(--text-primary);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-lock { background: #ff9800; color: white; }
        .btn-unlock { background: #4caf50; color: white; }
        .btn-pay { background: var(--success-green); color: white; width: 100%; padding: 15px; font-size: 18px; }

        .scroll-box {
            flex: 1;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 5px;
        }

        table { width: 100%; border-collapse: collapse; }
        th { background: var(--bg-secondary); padding: 12px; position: sticky; top: 0; text-align: left; }
        td { padding: 10px; border-bottom: 1px solid var(--border-color); }
        tr:hover { background: var(--bg-secondary); cursor: pointer; }
        .selected-row { background: rgba(57, 73, 171, 0.1) !important; border-left: 3px solid var(--main-blue); }

        /* Popups */
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(3px);
        }

        .popup-content {
            background: var(--bg-primary);
            padding: 25px;
            border-radius: 12px;
            width: 350px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            text-align: center;
        }

        /* ‡∂±‡∑Ä Alert Popup ‡∂ë‡∂ö ‡∑É‡∂≥‡∑Ñ‡∑è ‡∂∏‡∑ù‡∑É‡∑ä‡∂≠‡∂ª */
        #customAlert .popup-content {
            border-top: 8px solid var(--main-blue);
        }
        #customAlert.success .popup-content { border-top-color: var(--success-green); }
        #customAlert.error .popup-content { border-top-color: var(--error-red); }

        .popup-buttons { display: flex; gap: 10px; margin-top: 20px; }
        .popup-buttons button { flex: 1; padding: 10px; border-radius: 5px; cursor: pointer; border: none; font-weight: bold; }
        
        .theme-toggle { background: none; border: none; color: white; cursor: pointer; font-size: 20px; }
    </style>
</head>
<body>

<header>
    <div style="font-size: 20px; font-weight: bold;">CHANDANA STORES</div>
    <div style="display: flex; align-items: center; gap: 20px;">
        <div id="stats" style="color: #ccff90; font-size: 14px;">‡∂Ü‡∂Ø‡∑è‡∂∫‡∂∏: 0.00 | ‡∂Ω‡∑è‡∂∑‡∂∫: 0.00</div>
        <button class="theme-toggle" id="themeToggle">üåô</button>
    </div>
</header>

<div class="main-wrapper">
    <section class="inventory-section">
        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
            <input type="text" id="searchInput" class="search-bar" placeholder="‡∑É‡∑ô‡∑Ä‡∑ì‡∂∏..." onkeyup="searchItem()">
            <button id="lockBtn" class="btn btn-lock" onclick="handleSecurity()">üîí Unlock</button>
        </div>

        <div class="scroll-box">
            <table>
                <thead>
                    <tr><th>ID</th><th>‡∂±‡∂∏</th><th>‡∂∏‡∑í‡∂Ω</th><th>‡∑É‡∑ä‡∂ß‡∑ú‡∂ö‡∑ä</th></tr>
                </thead>
                <tbody id="inventoryBody"></tbody>
            </table>
        </div>
        <button class="btn" style="background: var(--main-blue); color: white; margin-top: 15px; padding: 15px;" onclick="addToCart()">‚ûï ‡∂ö‡∑è‡∂ª‡∑ä‡∂ß‡∑ä ‡∂ë‡∂ö‡∂ß ‡∂Ø‡∑è‡∂±‡∑ä‡∂±</button>
    </section>

    <section class="billing-section">
        <h2>‡∑Ä‡∂≠‡∑ä‡∂∏‡∂±‡∑ä ‡∂∂‡∑í‡∂Ω</h2>
        <div class="scroll-box">
            <ul id="cartList" style="list-style: none; padding: 0;"></ul>
        </div>
        <div style="margin-top: 10px;">
            <button class="btn" style="background: #607d8b; color: white; width: 100%; margin-bottom: 10px;" onclick="showDiscountPopup()">üí∞ ‡∑Ä‡∂ß‡∑ä‡∂ß‡∂∏‡∑ä</button>
            <div style="display: flex; justify-content: space-between; font-size: 22px; font-weight: bold; color: var(--error-red); padding: 10px 0;">
                <span>‡∂ë‡∂ö‡∂≠‡∑î‡∑Ä:</span>
                <span id="grandTotal">0.00</span>
            </div>
            <button class="btn btn-pay" onclick="checkout()">üí≥ PAY</button>
        </div>
    </section>
</div>

<div id="customAlert" class="popup-overlay">
    <div class="popup-content">
        <h3 id="alertTitle">‡∂¥‡∂´‡∑í‡∑Ä‡∑í‡∂©‡∂∫</h3>
        <p id="alertMessage"></p>
        <div class="popup-buttons">
            <button style="background: var(--main-blue); color: white;" onclick="closeAlert()">‡∑Ñ‡∂ª‡∑í</button>
        </div>
    </div>
</div>

<div id="itemNamePopup" class="popup-overlay">
    <div class="popup-content">
        <h3>‡∂±‡∂∏ ‡∑Ä‡∑ô‡∂±‡∑É‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</h3>
        <input type="text" id="newItemName" style="width: 90%; padding: 10px; margin: 10px 0;">
        <div class="popup-buttons">
            <button style="background: var(--success-green); color: white;" onclick="confirmItemNameChange()">‡∂Ö‡∂±‡∑î‡∂∏‡∂≠ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</button>
            <button style="background: #757575; color: white;" onclick="closePopup('itemNamePopup')">‡∂Ö‡∑Ä‡∂Ω‡∂Ç‡∂ú‡∑î ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</button>
        </div>
    </div>
</div>

<div id="discountPopup" class="popup-overlay">
    <div class="popup-content">
        <h3>‡∑Ä‡∂ß‡∑ä‡∂ß‡∂∏‡∑ä ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂± (Rs)</h3>
        <input type="number" id="discountAmount" style="width: 90%; padding: 10px; margin: 10px 0;">
        <div class="popup-buttons">
            <button style="background: var(--success-green); color: white;" onclick="confirmDiscount()">‡∑Ñ‡∂ª‡∑í</button>
            <button style="background: #757575; color: white;" onclick="closePopup('discountPopup')">‡∂Ö‡∑Ä‡∂Ω‡∂Ç‡∂ú‡∑î ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</button>
        </div>
    </div>
</div>

<script>
    let inventory = [];
    let cart = [];
    let isLocked = true;
    let selectedId = null;
    let totalIncome = 0;
    let totalProfit = 0;

    // --- ‡∂±‡∑Ä Alert Function ‡∂ë‡∂ö ---
    function showAlert(message, type = 'info') {
        const alertBox = document.getElementById('customAlert');
        const msgElement = document.getElementById('alertMessage');
        const titleElement = document.getElementById('alertTitle');
        
        alertBox.className = 'popup-overlay ' + type;
        msgElement.innerText = message;
        titleElement.innerText = type === 'error' ? '‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑ì‡∂∏‡∂ö‡∑ä!' : (type === 'success' ? '‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∂∫‡∑í!' : '‡∂¥‡∂´‡∑í‡∑Ä‡∑í‡∂©‡∂∫');
        
        alertBox.style.display = 'flex';
    }

    function closeAlert() {
        document.getElementById('customAlert').style.display = 'none';
    }

    function closePopup(id) {
        document.getElementById(id).style.display = 'none';
    }

    // ‡∂Ü‡∂ª‡∂∏‡∑ä‡∂∑‡∂ö ‡∂Ø‡∂≠‡∑ä‡∂≠
    function initialize() {
        const saved = localStorage.getItem('chandana_db');
        if (saved) {
            inventory = JSON.parse(saved);
        } else {
            for (let i = 1; i <= 200; i++) {
                inventory.push({ id: i, name: "‡∂Ö‡∂∫‡∑í‡∂≠‡∂∏‡∂∫ " + i, cost: 100, price: 150, stock: 50 });
            }
        }
        renderTable();
    }

    function renderTable() {
        const body = document.getElementById('inventoryBody');
        body.innerHTML = inventory.map(item => `
            <tr onclick="selectRow(${item.id})" id="row-${item.id}">
                <td>${item.id}</td>
                <td onclick="openNamePopup(${item.id})">${item.name}</td>
                <td>${item.price.toFixed(2)}</td>
                <td>${item.stock}</td>
            </tr>
        `).join('');
    }

    function selectRow(id) {
        selectedId = id;
        document.querySelectorAll('tr').forEach(r => r.classList.remove('selected-row'));
        document.getElementById('row-' + id).classList.add('selected-row');
    }

    function handleSecurity() {
        if (isLocked) {
            let pin = prompt("PIN ‡∂Ö‡∂Ç‡∂ö‡∂∫ (1234):"); // PIN ‡∂ë‡∂ö‡∂ß ‡∂≠‡∑Ä‡∂∏‡∂≠‡∑ä prompt ‡∂ë‡∂ö ‡∂≠‡∂∂‡∑è ‡∂á‡∂≠, ‡∂Ö‡∑Ä‡∑Å‡∑ä‚Äç‡∂∫ ‡∂±‡∂∏‡∑ä ‡∂ë‡∂∫‡∂Ø popup ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂ö‡∑Ö ‡∑Ñ‡∑ê‡∂ö
            if (pin === "1234") {
                isLocked = false;
                document.getElementById('lockBtn').innerText = "üîì Unlocked";
                document.getElementById('lockBtn').className = "btn btn-unlock";
                showAlert("‡∂Ø‡∑ê‡∂±‡∑ä ‡∂î‡∂∂‡∂ß ‡∂Ø‡∂≠‡∑ä‡∂≠ ‡∑É‡∂Ç‡∑É‡∑ä‡∂ö‡∂ª‡∂´‡∂∫ ‡∂ö‡∑Ö ‡∑Ñ‡∑ê‡∂ö.", "success");
            } else {
                showAlert("‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í PIN ‡∂Ö‡∂Ç‡∂ö‡∂∫‡∂ö‡∑í!", "error");
            }
        } else {
            isLocked = true;
            document.getElementById('lockBtn').innerText = "üîí Unlock";
            document.getElementById('lockBtn').className = "btn btn-lock";
        }
    }

    function addToCart() {
        if (!selectedId) {
            showAlert("‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂∑‡∑è‡∂´‡∑ä‡∂©‡∂∫‡∂ö‡∑ä ‡∂≠‡∑ù‡∂ª‡∂±‡∑ä‡∂±!", "error");
            return;
        }
        let item = inventory.find(i => i.id === selectedId);
        cart.push({ ...item, discount: 0 });
        updateCartUI();
    }

    function updateCartUI() {
        const list = document.getElementById('cartList');
        let total = 0;
        list.innerHTML = cart.map((item, idx) => {
            let final = item.price - item.discount;
            total += final;
            return `<li style="padding:10px; border-bottom:1px solid #eee; display:flex; justify-content:space-between;">
                <span>${idx+1}. ${item.name}</span>
                <span>Rs. ${final.toFixed(2)}</span>
            </li>`;
        }).join('');
        document.getElementById('grandTotal').innerText = total.toFixed(2);
    }

    function showDiscountPopup() {
        if (cart.length === 0) {
            showAlert("‡∂ö‡∑è‡∂ª‡∑ä‡∂ß‡∑ä ‡∂ë‡∂ö ‡∑Ñ‡∑í‡∑É‡∑ä!", "error");
            return;
        }
        document.getElementById('discountPopup').style.display = 'flex';
    }

    function confirmDiscount() {
        let amt = parseFloat(document.getElementById('discountAmount').value) || 0;
        if (amt > 0) {
            cart[cart.length-1].discount = amt; // ‡∂Ö‡∑Ä‡∑É‡∑è‡∂±‡∂∫‡∂ß ‡∂ë‡∂ö‡∑ä ‡∂ö‡∑Ö ‡∂∑‡∑è‡∂´‡∑ä‡∂©‡∂∫‡∂ß ‡∑Ä‡∂ß‡∑ä‡∂ß‡∂∏‡∑ä ‡∂∫‡∑ô‡∂Ø‡∑ì‡∂∏
            updateCartUI();
            closePopup('discountPopup');
            showAlert("‡∑Ä‡∂ß‡∑ä‡∂ß‡∂∏‡∑ä ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∑Ö‡∑è.", "success");
        }
    }

    function checkout() {
        if (cart.length === 0) return;
        
        cart.forEach(c => {
            let item = inventory.find(i => i.id === c.id);
            if (item.stock > 0) item.stock--;
            totalIncome += (c.price - c.discount);
            totalProfit += (c.price - c.discount - item.cost);
        });

        showAlert("‡∂ú‡∑ô‡∑Ä‡∑ì‡∂∏ ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∂∫‡∑í! ‡∑É‡∑ä‡∂≠‡∑î‡∂≠‡∑í‡∂∫‡∑í.", "success");
        document.getElementById('stats').innerText = `‡∂Ü‡∂Ø‡∑è‡∂∫‡∂∏: ${totalIncome.toFixed(2)} | ‡∂Ω‡∑è‡∂∑‡∂∫: ${totalProfit.toFixed(2)}`;
        cart = [];
        updateCartUI();
        renderTable();
    }

    window.onload = initialize;
</script>

</body>
</html>
