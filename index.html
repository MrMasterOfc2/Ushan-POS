
<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHANDANA STORES - PRO POS</title>
    <style>
        :root {
            --main-blue: #1a237e;
            --success-green: #2e7d32;
            --error-red: #c62828;
            --light-gray: #f5f6fa;
            --text-primary: #000000;
            --bg-primary: #ffffff;
            --bg-secondary: #f5f6fa;
            --border-color: #ddd;
            --shadow: rgba(0,0,0,0.1);
        }

        .dark-mode {
            --main-blue: #3949ab;
            --success-green: #4caf50;
            --error-red: #ef5350;
            --light-gray: #1e1e1e;
            --text-primary: #ffffff;
            --bg-primary: #121212;
            --bg-secondary: #1e1e1e;
            --border-color: #333;
            --shadow: rgba(255,255,255,0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
        }

        header {
            background: var(--main-blue);
            color: white;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .main-wrapper {
            display: flex;
            flex: 1;
            overflow: hidden;
            padding: 10px;
            gap: 15px;
        }

        .inventory-section {
            flex: 2;
            background: var(--bg-primary);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            padding: 15px;
            border: 1px solid var(--border-color);
        }

        .billing-section {
            flex: 1;
            background: var(--bg-primary);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            padding: 15px;
            border-left: 5px solid var(--main-blue);
            border: 1px solid var(--border-color);
            min-width: 320px;
        }

        .search-bar {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            margin-bottom: 15px;
            background-color: var(--bg-primary);
            color: var(--text-primary);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-lock { background: #ff9800; color: white; }
        .btn-unlock { background: #4caf50; color: white; }
        .btn-pay { 
            background: var(--success-green); 
            color: white; 
            width: 100%; 
            padding: 15px; 
            font-size: 18px;
            margin-top: 10px;
        }

        .scroll-box {
            flex: 1;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background: var(--bg-primary);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: var(--bg-secondary);
            padding: 12px;
            position: sticky;
            top: 0;
            text-align: left;
        }

        td {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        tr:hover { background: var(--bg-secondary); cursor: pointer; }
        .selected-row { background: rgba(57, 73, 171, 0.1) !important; }

        /* ‡∂¥‡∑í‡∂±‡∑ä‡∂≠‡∑ñ‡∂ª‡∂∫‡∑ö ‡∂á‡∂≠‡∑í ‡∂Ü‡∂ö‡∑è‡∂ª‡∂∫‡∂ß ‡∂∂‡∑í‡∂Ω‡∑ä‡∂¥‡∂≠‡∑ö ‡∂∏‡∑ù‡∑É‡∑ä‡∂≠‡∂ª‡∂∫ */
        #cartList li {
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .cart-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .price-display {
            text-align: right;
        }

        .original-price {
            text-decoration: line-through;
            color: var(--error-red);
            font-size: 12px;
            display: block;
        }

        .final-price {
            font-weight: bold;
            font-size: 16px;
        }

        .discount-label {
            color: var(--success-green);
            font-size: 13px;
            font-weight: bold;
        }

        .remove-btn {
            color: var(--error-red);
            cursor: pointer;
            font-size: 20px;
            text-align: right;
            display: block;
            margin-top: 2px;
        }

        .btn-discount-fixed {
            background: #a2d2ff;
            color: #000;
            width: 100%;
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }

        /* Stock styles */
        .stock-warning { color: var(--error-red) !important; font-weight: bold; }
        .nav-tabs { display: flex; background: var(--main-blue); }
        .nav-tabs button { background: none; border: none; color: white; padding: 12px 20px; cursor: pointer; opacity: 0.7; }
        .nav-tabs button.active { opacity: 1; border-bottom: 3px solid white; }
        .page-content { display: none; flex: 1; flex-direction: column; overflow: hidden; }
        .page-content.active { display: flex; }
        .tag { padding: 2px 8px; border-radius: 10px; font-size: 12px; font-weight: bold; color: white; }
        .tag-sold { background: #4caf50; }
        .tag-stock-in { background: #2196f3; }

        .popup-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center; align-items: center;
        }
        .popup-content { background: var(--bg-primary); padding: 25px; border-radius: 10px; width: 350px; }
        .popup-input { width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box; }
    </style>
</head>
<body>

<header>
    <div style="font-size: 20px; font-weight: bold;">CHANDANA STORES</div>
    <div style="display: flex; align-items: center; gap: 15px;">
        <button id="themeToggle" style="background:none; border:none; cursor:pointer; font-size: 20px;">üåô</button>
        <div id="stats" style="color: #ccff90; font-size: 14px;">‡∂Ü‡∂Ø‡∑è‡∂∫‡∂∏: 0.00 | ‡∂Ω‡∑è‡∂∑‡∂∫: 0.00</div>
    </div>
</header>

<nav class="nav-tabs">
    <button id="posTab" class="active" onclick="switchPage('posPage')">POS (‡∂∂‡∑í‡∂Ω‡∑ä‡∂¥‡∂≠‡∑ä)</button>
    <button id="stockTab" onclick="switchPage('stockPage')">STOCK (‡∂≠‡∑ú‡∂ú ‡∑Ä‡∑è‡∂ª‡∑ä‡∂≠‡∑è)</button>
</nav>

<div id="posPage" class="page-content active">
    <div class="main-wrapper">
        <section class="inventory-section">
            <div style="display: flex; gap: 10px;">
                <input type="text" id="searchInput" class="search-bar" placeholder="‡∑É‡∑ô‡∑Ä‡∑ì‡∂∏..." onkeyup="searchItem()">
                <button id="lockBtn" class="btn btn-lock" onclick="handleSecurity()">üîí Unlock</button>
            </div>
            <div class="scroll-box">
                <table>
                    <thead>
                        <tr><th>ID</th><th>‡∂∑‡∑è‡∂´‡∑ä‡∂©‡∂∫‡∑ö ‡∂±‡∂∏</th><th>‡∂∏‡∑í‡∂Ω</th><th>‡∑É‡∑ä‡∂ß‡∑ú‡∂ö‡∑ä</th></tr>
                    </thead>
                    <tbody id="inventoryBody"></tbody>
                </table>
            </div>
            <button class="btn" style="background: var(--main-blue); color: white; margin-top: 10px; padding: 15px;" onclick="addToCart()">‚ûï ‡∂ö‡∑è‡∂ª‡∑ä‡∂ß‡∑ä ‡∂ë‡∂ö‡∂ß ‡∂Ø‡∑è‡∂±‡∑ä‡∂±</button>
        </section>

        <section class="billing-section">
            <h2 style="margin-top: 0;">‡∑Ä‡∂≠‡∑ä‡∂∏‡∂±‡∑ä ‡∂∂‡∑í‡∂Ω</h2>
            <div class="scroll-box">
                <ul id="cartList" style="list-style: none; padding: 0;"></ul>
            </div>
            <div style="margin-top: 10px;">
                <button class="btn btn-discount-fixed" onclick="showDiscountPopup()">üí∞ ‡∑Ä‡∂ß‡∑ä‡∂ß‡∂∏‡∑ä (Discount)</button>
                <div style="display: flex; justify-content: space-between; font-size: 22px; font-weight: bold; color: var(--error-red); padding: 5px 0;">
                    <span>‡∂ë‡∂ö‡∂≠‡∑î‡∑Ä:</span>
                    <span id="grandTotal">0.00</span>
                </div>
                <button class="btn btn-pay" onclick="checkout()">üí≥ ‡∂ú‡∑ô‡∑Ä‡∑ì‡∂∏ ‡∂Ö‡∑Ä‡∑É‡∂±‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂± (PAY)</button>
            </div>
        </section>
    </div>
</div>

<div id="stockPage" class="page-content">
    <div class="main-wrapper">
        <section class="inventory-section">
            <h3>‡∑É‡∑ä‡∂ß‡∑ú‡∂ö‡∑ä ‡∑É‡∑Ñ ‡∑Ä‡∑í‡∂ö‡∑î‡∂´‡∑î‡∂∏‡∑ä ‡∑Ä‡∑è‡∂ª‡∑ä‡∂≠‡∑è</h3>
            <div class="scroll-box">
                <table>
                    <thead><tr><th>‡∂Ø‡∑í‡∂±‡∂∫</th><th>‡∂≠‡∂≠‡∑ä‡∂≠‡∑ä‡∑Ä‡∂∫</th><th>‡∂∑‡∑è‡∂´‡∑ä‡∂©‡∂∫</th><th>‡∂¥‡∑ä‚Äç‡∂ª‡∂∏‡∑è‡∂´‡∂∫</th></tr></thead>
                    <tbody id="stockLogBody"></tbody>
                </table>
            </div>
        </section>
    </div>
</div>

<div id="discountPopup" class="popup-overlay"><div class="popup-content">
    <h3>‡∑Ä‡∂ß‡∑ä‡∂ß‡∂∏‡∑ä ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</h3>
    <input type="number" id="discountAmount" class="popup-input" placeholder="‡∂∏‡∑î‡∂Ø‡∂Ω (Rs.)">
    <div style="display: flex; gap: 10px;">
        <button class="btn" style="background:var(--success-green); color:white; flex:1;" onclick="confirmDiscount()">‡∂∫‡∑ú‡∂Ø‡∂±‡∑ä‡∂±</button>
        <button class="btn" style="background:#757575; color:white; flex:1;" onclick="closePopup('discountPopup')">‡∂Ö‡∑Ä‡∂Ω‡∂Ç‡∂ú‡∑î ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</button>
    </div>
</div></div>

<div id="receiptPopup" class="popup-overlay"><div class="popup-content">
    <h3>‡∂ú‡∑ô‡∑Ä‡∑ì‡∂∏ ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∂∫‡∑í! ‚úì</h3>
    <div id="receiptDetails" style="margin: 15px 0; border-top: 1px solid #ddd; padding-top: 10px;"></div>
    <h3 style="color:var(--error-red);">‡∂∏‡∑î‡∑Ö‡∑î ‡∂ë‡∂ö‡∂≠‡∑î‡∑Ä: Rs. <span id="receiptTotal">0.00</span></h3>
    <button class="btn" style="background:var(--main-blue); color:white; width:100%;" onclick="closePopup('receiptPopup')">‡∑Ñ‡∂ª‡∑í</button>
</div></div>

<script>
    let inventory = [];
    let cart = [];
    let stockLogs = [];
    let isLocked = true;
    let selectedId = null;
    let totalIncome = 0;
    let totalProfit = 0;
    let discountItemIndex = null;
    let isDarkMode = false;

    function initialize() {
        const saved = localStorage.getItem('chandana_db');
        const logs = localStorage.getItem('chandana_logs');
        if (saved) {
            inventory = JSON.parse(saved);
        } else {
            for (let i = 1; i <= 200; i++) {
                inventory.push({ id: i, name: "‡∂∑‡∑è‡∂´‡∑ä‡∂©‡∂∫ " + i, cost: 100, price: 150, stock: 50 });
            }
            saveToStorage();
        }
        if(logs) stockLogs = JSON.parse(logs);
        renderTable();
        renderLogs();
    }

    function saveToStorage() {
        localStorage.setItem('chandana_db', JSON.stringify(inventory));
        localStorage.setItem('chandana_logs', JSON.stringify(stockLogs));
    }

    function renderTable() {
        const body = document.getElementById('inventoryBody');
        body.innerHTML = inventory.map(item => `
            <tr onclick="selectRow(${item.id})" id="row-${item.id}">
                <td>${item.id}</td>
                <td>${item.name}</td>
                <td>${item.price.toFixed(2)}</td>
                <td class="${item.stock <= 10 ? 'stock-warning' : ''}">${item.stock} ${item.stock <= 10 ? '‚ö†Ô∏è' : ''}</td>
            </tr>
        `).join('');
    }

    function selectRow(id) {
        selectedId = id;
        document.querySelectorAll('tr').forEach(r => r.classList.remove('selected-row'));
        document.getElementById('row-' + id).classList.add('selected-row');
    }

    function addToCart() {
        if (!selectedId) return alert("‡∂∑‡∑è‡∂´‡∑ä‡∂©‡∂∫‡∂ö‡∑ä ‡∂≠‡∑ù‡∂ª‡∂±‡∑ä‡∂±!");
        let item = inventory.find(i => i.id === selectedId);
        if(item.stock <= 0) return alert("‡∂≠‡∑ú‡∂ú ‡∂Ö‡∑Ä‡∑É‡∂±‡∑ä!");
        cart.push({ ...item, discount: 0 });
        updateCartUI();
    }

    function updateCartUI() {
        const list = document.getElementById('cartList');
        let total = 0;
        list.innerHTML = cart.map((item, idx) => {
            let finalPrice = item.price - item.discount;
            total += finalPrice;
            return `
                <li>
                    <div class="cart-row">
                        <div><strong>${idx + 1}. ${item.name}</strong></div>
                        <div class="price-display">
                            <span class="final-price">Rs. ${finalPrice.toFixed(2)}</span>
                            ${item.discount > 0 ? `<span class="original-price">Rs. ${item.price.toFixed(2)}</span>` : ''}
                        </div>
                    </div>
                    <div class="cart-row">
                        <div class="discount-label">${item.discount > 0 ? `‡∑Ä‡∂ß‡∑ä‡∂ß‡∂∏: Rs. ${item.discount.toFixed(2)}` : ''}</div>
                        <div class="remove-btn" onclick="removeFromCart(${idx})">‚ìß</div>
                    </div>
                </li>`;
        }).join('');
        document.getElementById('grandTotal').innerText = total.toFixed(2);
    }

    function showDiscountPopup() {
        if (cart.length === 0) return alert("‡∂ö‡∑è‡∂ª‡∑ä‡∂ß‡∑ä ‡∂ë‡∂ö ‡∑Ñ‡∑í‡∑É‡∑ä!");
        let num = prompt("‡∂Ö‡∂∫‡∑í‡∂≠‡∂∏ ‡∂Ö‡∂Ç‡∂ö‡∂∫ (1-" + cart.length + "):");
        if (num > 0 && num <= cart.length) {
            discountItemIndex = num - 1;
            document.getElementById('discountPopup').style.display = 'flex';
        }
    }

    function confirmDiscount() {
        let amt = parseFloat(document.getElementById('discountAmount').value) || 0;
        cart[discountItemIndex].discount = amt;
        updateCartUI();
        closePopup('discountPopup');
        document.getElementById('discountAmount').value = '';
    }

    function removeFromCart(index) { cart.splice(index, 1); updateCartUI(); }

    function checkout() {
        if (cart.length === 0) return;
        let billTotal = 0;
        let details = "";
        cart.forEach(c => {
            let item = inventory.find(i => i.id === c.id);
            item.stock--;
            let final = c.price - c.discount;
            billTotal += final;
            totalIncome += final;
            totalProfit += (final - item.cost);
            addLog('SOLD', item.name, 1);
            details += `<p>${c.name} - Rs. ${final.toFixed(2)}</p>`;
        });
        document.getElementById('stats').innerText = `‡∂Ü‡∂Ø‡∑è‡∂∫‡∂∏: ${totalIncome.toFixed(2)} | ‡∂Ω‡∑è‡∂∑‡∂∫: ${totalProfit.toFixed(2)}`;
        document.getElementById('receiptTotal').innerText = billTotal.toFixed(2);
        document.getElementById('receiptDetails').innerHTML = details;
        document.getElementById('receiptPopup').style.display = 'flex';
        cart = []; updateCartUI(); saveToStorage(); renderTable();
    }

    function addLog(type, name, qty) {
        stockLogs.unshift({ time: new Date().toLocaleString(), type, name, qty });
        if(stockLogs.length > 50) stockLogs.pop();
        saveToStorage();
    }

    function renderLogs() {
        document.getElementById('stockLogBody').innerHTML = stockLogs.map(log => `
            <tr><td>${log.time}</td><td><span class="tag ${log.type === 'SOLD' ? 'tag-sold' : 'tag-stock-in'}">${log.type}</span></td><td>${log.name}</td><td>${log.qty}</td></tr>
        `).join('');
    }

    function switchPage(p) {
        document.querySelectorAll('.page-content').forEach(pg => pg.classList.remove('active'));
        document.querySelectorAll('.nav-tabs button').forEach(b => b.classList.remove('active'));
        document.getElementById(p).classList.add('active');
        if(p === 'stockPage') renderLogs();
    }

    function handleSecurity() {
        if (isLocked) {
            if (prompt("PIN:") === "1234") { isLocked = false; document.getElementById('lockBtn').innerHTML = 'üîì Unlocked'; }
        } else { isLocked = true; document.getElementById('lockBtn').innerHTML = 'üîí Unlock'; }
    }

    function closePopup(id) { document.getElementById(id).style.display = 'none'; }
    
    document.getElementById('themeToggle').onclick = () => {
        isDarkMode = !isDarkMode;
        document.body.classList.toggle('dark-mode');
        document.getElementById('themeToggle').innerText = isDarkMode ? '‚òÄÔ∏è' : 'üåô';
    };

    window.onload = initialize;
</script>
</body>
</html>
