<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHANDANA STORES - ADVANCED POS</title>
    <style>
        /* --- 1. ‡∂∏‡∑ù‡∑É‡∑ä‡∂≠‡∂ª (CSS) --- */
        :root {
            --main-blue: #1a237e;
            --success-green: #2e7d32;
            --error-red: #c62828;
            --warning-orange: #ff9800;
            --light-gray: #f5f6fa;
            --text-primary: #000000;
            --bg-primary: #ffffff;
            --bg-secondary: #f5f6fa;
            --border-color: #ddd;
            --shadow: 0 4px 15px rgba(0,0,0,0.2);
            --discount-color: #ff5722;
        }

        .dark-mode {
            --main-blue: #3949ab;
            --success-green: #4caf50;
            --error-red: #ef5350;
            --warning-orange: #ffb74d;
            --light-gray: #1e1e1e;
            --text-primary: #ffffff;
            --bg-primary: #121212;
            --bg-secondary: #1e1e1e;
            --border-color: #333;
            --shadow: 0 4px 15px rgba(0,0,0,0.5);
            --discount-color: #ff8a65;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
        }

        header {
            background: var(--main-blue);
            color: white;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 10;
        }

        .header-controls { display: flex; gap: 15px; align-items: center; }

        /* Navigation */
        .nav-tabs { display: flex; background: var(--bg-primary); border-bottom: 1px solid var(--border-color); padding: 0 20px; }
        .tab-btn {
            padding: 15px 25px; border: none; background: none; font-size: 16px; font-weight: bold;
            color: var(--text-primary); cursor: pointer; border-bottom: 3px solid transparent; opacity: 0.6; transition: 0.3s;
        }
        .tab-btn.active { border-bottom-color: var(--main-blue); color: var(--main-blue); opacity: 1; }

        .view-section { display: none; flex: 1; overflow: hidden; padding: 10px; gap: 15px; height: 100%; }
        .view-section.active-view { display: flex; }

        /* POS & Stock Sections */
        .inventory-section, .billing-section, .stock-form-section, .stock-history-section, .settings-container {
            background: var(--bg-primary); border-radius: 10px; padding: 15px; border: 1px solid var(--border-color); box-shadow: var(--shadow);
        }
        .inventory-section { flex: 2; display: flex; flex-direction: column; }
        .billing-section { flex: 1; display: flex; flex-direction: column; min-width: 340px; border-left: 5px solid var(--main-blue); }
        .stock-form-section { flex: 1; max-width: 400px; overflow-y: auto; }
        .stock-history-section { flex: 2; display: flex; flex-direction: column; }

        /* Tables & Inputs */
        .scroll-box { flex: 1; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 5px; margin-top: 10px; }
        table { width: 100%; border-collapse: collapse; }
        th { background: var(--bg-secondary); padding: 12px; position: sticky; top: 0; text-align: left; }
        td { padding: 10px; border-bottom: 1px solid var(--border-color); }
        tr:hover { background: var(--bg-secondary); }
        .selected-row { background: rgba(57, 73, 171, 0.1) !important; border-left: 3px solid var(--main-blue); }

        .form-input, .search-bar, select {
            width: 100%; padding: 12px; font-size: 16px; border: 1px solid var(--border-color); border-radius: 5px;
            background: var(--bg-primary); color: var(--text-primary); box-sizing: border-box;
        }

        .btn {
            padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;
            display: flex; align-items: center; justify-content: center; gap: 8px; transition: 0.2s;
        }
        .btn:active { transform: scale(0.98); }
        .btn-lock { background: var(--warning-orange); color: white; }
        .btn-unlock { background: var(--success-green); color: white; }
        .btn-pay { background: var(--main-blue); color: white; width: 100%; padding: 15px; font-size: 18px; }
        .btn-undo { background: var(--error-red); color: white; padding: 5px 10px; font-size: 12px; }

        /* Advanced Popup Styles */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 2000; justify-content: center; align-items: center;
            backdrop-filter: blur(4px); animation: fadeIn 0.2s;
        }
        .modal-content {
            background: var(--bg-primary); padding: 25px; border-radius: 15px; width: 350px;
            box-shadow: var(--shadow); text-align: center; animation: slideUp 0.3s;
        }
        .modal-title { font-size: 20px; font-weight: bold; margin-bottom: 15px; color: var(--main-blue); }
        .modal-body { margin-bottom: 20px; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); } to { transform: translateY(0); } }

        /* Cart Styling */
        #cartList li { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid var(--border-color); }
        .summary-row { display: flex; justify-content: space-between; margin-bottom: 5px; }
        .summary-row.total { font-size: 20px; font-weight: bold; color: var(--main-blue); border-top: 2px solid var(--border-color); padding-top: 10px; }

        @media (max-width: 768px) {
            .view-section { flex-direction: column; overflow-y: auto; }
            .billing-section, .stock-form-section { min-width: 100%; }
        }
    </style>
</head>
<body>

<header>
    <div style="font-size: 20px; font-weight: bold;">CHANDANA STORES</div>
    <div class="header-controls">
        <button class="tab-btn" style="color:white; opacity:1" id="themeToggle">üåô</button>
        <div id="stats" style="color: #ccff90; font-size: 14px;">‡∂Ü‡∂Ø‡∑è‡∂∫‡∂∏: 0.00</div>
    </div>
</header>

<div class="nav-tabs">
    <button class="tab-btn active" onclick="switchView('pos')" id="tab-pos">POS / Billing</button>
    <button class="tab-btn" onclick="switchView('stock')" id="tab-stock">Stock Management</button>
    <button class="tab-btn" onclick="switchView('settings')" id="tab-settings">Settings</button>
</div>

<div id="pos-view" class="view-section active-view">
    <section class="inventory-section">
        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
            <input type="text" id="searchInput" class="search-bar" placeholder="üîç Scan Barcode or Type Name..." onkeyup="handleSearchInput(event)">
            <button id="lockBtn" class="btn btn-lock" onclick="openPinModal()">üîí Unlock</button>
        </div>
        <div class="scroll-box">
            <table>
                <thead><tr><th>ID</th><th>‡∂±‡∂∏</th><th>‡∂∏‡∑í‡∂Ω</th><th>‡∑É‡∑ä‡∂ß‡∑ú‡∂ö‡∑ä</th></tr></thead>
                <tbody id="inventoryBody"></tbody>
            </table>
        </div>
        <button class="btn" style="background: var(--success-green); color: white; margin-top: 10px; height: 50px;" onclick="addToCart()">‚ûï ‡∂ö‡∑è‡∂ª‡∑ä‡∂ß‡∑ä ‡∂ë‡∂ö‡∂ß ‡∂Ø‡∑è‡∂±‡∑ä‡∂±</button>
    </section>

    <section class="billing-section">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h3>‡∑Ä‡∂≠‡∑ä‡∂∏‡∂±‡∑ä ‡∂∂‡∑í‡∂Ω</h3>
            <button class="btn btn-undo" onclick="undoLastItem()">‚Ü© Undo</button>
        </div>
        <div class="scroll-box"><ul id="cartList" style="list-style:none; padding:0;"></ul></div>
        <div class="bill-summary">
            <div class="summary-row"><span>‡∂ã‡∂¥ ‡∂ë‡∂ö‡∂≠‡∑î‡∑Ä:</span><span id="subTotalDisplay">0.00</span></div>
            <div class="summary-row total"><span>‡∂ë‡∂ö‡∂≠‡∑î‡∑Ä:</span><span id="grandTotal">0.00</span></div>
            <button class="btn btn-pay" onclick="checkout()">üí≥ PAY (‡∂∂‡∑í‡∂Ω‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±)</button>
        </div>
    </section>
</div>

<div id="stock-view" class="view-section">
    <section class="stock-form-section">
        <h3>‡∑É‡∑ä‡∂ß‡∑ú‡∂ö‡∑ä ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏</h3>
        <input type="number" id="stockItemId" class="form-input" placeholder="Scan Barcode / ID" onkeyup="if(event.key==='Enter') fillItemDetails()" style="margin-bottom:10px">
        <input type="text" id="stockItemName" class="form-input" placeholder="‡∂∑‡∑è‡∂´‡∑ä‡∂©‡∂∫‡∑ö ‡∂±‡∂∏" style="margin-bottom:10px">
        <input type="number" id="stockQty" class="form-input" placeholder="‡∂¥‡∑ä‚Äç‡∂ª‡∂∏‡∑è‡∂´‡∂∫ (Qty)" style="margin-bottom:10px">
        <input type="number" id="stockPrice" class="form-input" placeholder="‡∑Ä‡∑í‡∂ö‡∑î‡∂´‡∑î‡∂∏‡∑ä ‡∂∏‡∑í‡∂Ω" style="margin-bottom:10px">
        <input type="number" id="stockCost" class="form-input" placeholder="‡∂ú‡∑ê‡∂´‡∑î‡∂∏‡∑ä ‡∂∏‡∑í‡∂Ω (Cost)" style="margin-bottom:10px">
        <button class="btn btn-pay" style="background:var(--success-green)" onclick="addNewStock()">üì• ‡∑É‡∑ä‡∂ß‡∑ú‡∂ö‡∑ä ‡∂ë‡∂ö‡∂≠‡∑î ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</button>
    </section>
    <section class="stock-history-section">
        <h3>‡∑É‡∑ä‡∂ß‡∑ú‡∂ö‡∑ä ‡∂â‡∂≠‡∑í‡∑Ñ‡∑è‡∑É‡∂∫</h3>
        <div class="scroll-box">
            <table><thead><tr><th>‡∂Ø‡∑í‡∂±‡∂∫</th><th>‡∂∑‡∑è‡∂´‡∑ä‡∂©‡∂∫</th><th>‡∂¥‡∑ä‚Äç‡∂ª‡∂∏‡∑è‡∂´‡∂∫</th></tr></thead><tbody id="stockHistoryBody"></tbody></table>
        </div>
    </section>
</div>

<div id="settings-view" class="view-section">
    <div class="settings-container" style="width: 100%;">
        <h3>‡∂¥‡∂Ø‡∑ä‡∂∞‡∂≠‡∑í ‡∑É‡∂ö‡∑É‡∑î‡∂∏‡∑ä</h3>
        <label>‡∂¥‡∑ä‚Äç‡∂ª‡∑í‡∂±‡∑ä‡∂ß‡∂ª‡∑ä ‡∂¥‡∑ä‚Äç‡∂ª‡∂∏‡∑è‡∂´‡∂∫:</label>
        <select id="paperSizeSelect" class="form-input" onchange="savePaperSize()">
            <option value="80mm">80mm Standard</option>
            <option value="58mm">58mm Mini</option>
        </select>
        <button class="btn btn-lock" style="margin-top:20px" onclick="clearData()">‚ö†Ô∏è ‡∂Ø‡∂≠‡∑ä‡∂≠ ‡∂∏‡∂ö‡∑è ‡∂Ø‡∂∏‡∂±‡∑ä‡∂± (Reset)</button>
    </div>
</div>

<div id="alertModal" class="modal-overlay">
    <div class="modal-content">
        <div id="alertTitle" class="modal-title">‡∂¥‡∂´‡∑í‡∑Ä‡∑í‡∂©‡∂∫</div>
        <div id="alertBody" class="modal-body">‡∂∏‡∑ô‡∑Ñ‡∑í ‡∂¥‡∂´‡∑í‡∑Ä‡∑í‡∂©‡∂∫ ‡∂Ø‡∑í‡∑É‡∑ä‡∑Ä‡∑ö.</div>
        <button class="btn btn-pay" onclick="closeModal('alertModal')">‡∑Ñ‡∂ª‡∑í (OK)</button>
    </div>
</div>

<div id="pinModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-title">üîê ‡∂Ü‡∂ª‡∂ö‡∑ä‡∑Ç‡∂ö ‡∂Ö‡∂ú‡∑î‡∂Ω (PIN)</div>
        <div class="modal-body">
            <p>‡∂Ø‡∂≠‡∑ä‡∂≠ ‡∑Ä‡∑ô‡∂±‡∑É‡∑ä ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∂ß PIN ‡∂Ö‡∂Ç‡∂ö‡∂∫ ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.</p>
            <input type="password" id="pinInput" class="form-input" placeholder="Enter PIN" style="text-align:center; font-size:24px; letter-spacing:5px">
        </div>
        <div style="display: flex; gap: 10px;">
            <button class="btn btn-pay" onclick="checkPin()">Unlock</button>
            <button class="btn btn-undo" style="background:#757575; flex:1" onclick="closeModal('pinModal')">Cancel</button>
        </div>
    </div>
</div>

<div id="receiptModal" class="modal-overlay">
    <div class="modal-content" style="width: 300px;">
        <div class="modal-title">‡∂ª‡∑í‡∑É‡∑í‡∂ß‡∑ä ‡∂¥‡∂≠</div>
        <div id="receiptPreview" style="text-align:left; font-family:monospace; background:white; color:black; padding:10px; border:1px solid #ccc; font-size:12px;"></div>
        <div style="display:flex; gap:10px; margin-top:15px;">
            <button class="btn btn-pay" onclick="window.print()">Print</button>
            <button class="btn btn-undo" style="background:#757575" onclick="closeModal('receiptModal')">Close</button>
        </div>
    </div>
</div>

<script>
    /* --- JS Logic --- */
    let inventory = JSON.parse(localStorage.getItem('chandana_db')) || [];
    let cart = [];
    let isLocked = true;
    let selectedId = null;

    // Initialize
    window.onload = () => {
        if(inventory.length === 0) {
            for(let i=1; i<=10; i++) inventory.push({id: i, name: "Item "+i, price: 100, cost: 80, stock: 50});
        }
        renderTable();
        document.getElementById('searchInput').focus();
    };

    // Modal Helpers
    function showCustomAlert(title, message) {
        document.getElementById('alertTitle').innerText = title;
        document.getElementById('alertBody').innerText = message;
        document.getElementById('alertModal').style.display = 'flex';
    }

    function openPinModal() {
        if(!isLocked) {
            isLocked = true;
            updateLockUI();
            return;
        }
        document.getElementById('pinModal').style.display = 'flex';
        document.getElementById('pinInput').value = '';
        document.getElementById('pinInput').focus();
    }

    function closeModal(id) { document.getElementById(id).style.display = 'none'; }

    function checkPin() {
        let pin = document.getElementById('pinInput').value;
        if(pin === "1234") {
            isLocked = false;
            updateLockUI();
            closeModal('pinModal');
            showCustomAlert("‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∂∫‡∑í", "‡∂Ø‡∂≠‡∑ä‡∂≠ ‡∑Ä‡∑ô‡∂±‡∑É‡∑ä ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö ‡∂¥‡∑Ñ‡∑É‡∑î‡∂ö‡∂∏ ‡∂Ω‡∑ê‡∂∂‡∑î‡∂´‡∑í.");
        } else {
            showCustomAlert("‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í‡∂∫‡∑í", "‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∑Ö PIN ‡∂Ö‡∂Ç‡∂ö‡∂∫ ‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í‡∂∫‡∑í!");
        }
    }

    function updateLockUI() {
        const btn = document.getElementById('lockBtn');
        btn.innerHTML = isLocked ? "üîí Unlock" : "üîì Unlocked";
        btn.className = isLocked ? "btn btn-lock" : "btn btn-unlock";
    }

    // POS Logic
    function handleSearchInput(e) {
        let val = e.target.value;
        if(e.key === "Enter") {
            let item = inventory.find(i => i.id == val);
            if(item) {
                cart.push({...item});
                updateCart();
                e.target.value = "";
            } else {
                showCustomAlert("‡∑É‡∑ú‡∂∫‡∑è‡∂ú‡∂≠ ‡∂±‡∑ú‡∑Ñ‡∑ê‡∂ö", "‡∂∏‡∑ô‡∂∏ ‡∂∂‡∑è‡∂ª‡∑ä‡∂ö‡∑ù‡∂©‡∑ä ‡∂ë‡∂ö ‡∑É‡∑Ñ‡∑í‡∂≠ ‡∂∑‡∑è‡∂´‡∑ä‡∂©‡∂∫‡∂ö‡∑ä ‡∂±‡∑ú‡∂∏‡∑ê‡∂≠.");
            }
        }
        filterTable(val);
    }

    function filterTable(val) {
        let rows = document.getElementById('inventoryBody').getElementsByTagName('tr');
        for(let r of rows) r.style.display = r.innerText.toLowerCase().includes(val.toLowerCase()) ? "" : "none";
    }

    function renderTable() {
        const body = document.getElementById('inventoryBody');
        body.innerHTML = inventory.map(item => `
            <tr onclick="selectRow(${item.id})" id="row-${item.id}">
                <td>${item.id}</td>
                <td onclick="editField(${item.id}, 'name')">${item.name}</td>
                <td onclick="editField(${item.id}, 'price')">${item.price.toFixed(2)}</td>
                <td>${item.stock}</td>
            </tr>
        `).join('');
    }

    function selectRow(id) {
        selectedId = id;
        document.querySelectorAll('tr').forEach(r => r.classList.remove('selected-row'));
        document.getElementById('row-'+id).classList.add('selected-row');
    }

    function addToCart() {
        if(!selectedId) { showCustomAlert("‡∂Ö‡∑Ä‡∑Ä‡∑è‡∂Ø‡∂∫‡∂∫‡∑í", "‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂∑‡∑è‡∂´‡∑ä‡∂©‡∂∫‡∂ö‡∑ä ‡∂≠‡∑ù‡∂ª‡∂±‡∑ä‡∂±."); return; }
        let item = inventory.find(i => i.id === selectedId);
        cart.push({...item});
        updateCart();
    }

    function undoLastItem() {
        if(cart.length > 0) { cart.pop(); updateCart(); }
    }

    function updateCart() {
        const list = document.getElementById('cartList');
        let total = 0;
        list.innerHTML = cart.map((item, idx) => {
            total += item.price;
            return `<li><span>${idx+1}. ${item.name}</span> <b>${item.price.toFixed(2)}</b></li>`;
        }).join('');
        document.getElementById('subTotalDisplay').innerText = total.toFixed(2);
        document.getElementById('grandTotal').innerText = total.toFixed(2);
    }

    function checkout() {
        if(cart.length === 0) { showCustomAlert("‡∑Ñ‡∑í‡∑É‡∑ä", "‡∂∂‡∑í‡∂Ω‡∑ä ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∂ß ‡∂∑‡∑è‡∂´‡∑ä‡∂© ‡∂±‡∑ú‡∂∏‡∑ê‡∂≠."); return; }
        
        let receipt = "CHANDANA STORES\n------------------\n";
        cart.forEach(item => {
            receipt += `${item.name.padEnd(12)} ${item.price.toFixed(2)}\n`;
            let invItem = inventory.find(i => i.id === item.id);
            if(invItem) invItem.stock--;
        });
        receipt += "------------------\nTOTAL: Rs. " + document.getElementById('grandTotal').innerText;
        
        document.getElementById('receiptPreview').innerText = receipt;
        document.getElementById('receiptModal').style.display = 'flex';
        
        cart = [];
        updateCart();
        renderTable();
        localStorage.setItem('chandana_db', JSON.stringify(inventory));
    }

    function editField(id, field) {
        if(isLocked) { showCustomAlert("‡∂Ö‡∂ú‡∑î‡∑Ö‡∑î ‡∂Ø‡∂∏‡∑è ‡∂á‡∂≠", "‡∂Ø‡∂≠‡∑ä‡∂≠ ‡∑Ä‡∑ô‡∂±‡∑É‡∑ä ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∂ß ‡∂¥‡∑ä‚Äç‡∂ª‡∂Æ‡∂∏‡∂∫‡∑ô‡∂±‡∑ä Unlock ‡∂ö‡∂ª‡∂±‡∑ä‡∂±."); return; }
        let item = inventory.find(i => i.id === id);
        let newVal = prompt(`${field} ‡∑Ä‡∑ô‡∂±‡∑É‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±:`, item[field]);
        if(newVal) {
            item[field] = field === 'name' ? newVal : parseFloat(newVal);
            renderTable();
            localStorage.setItem('chandana_db', JSON.stringify(inventory));
        }
    }

    // View Switching
    function switchView(view) {
        document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active-view'));
        document.querySelectorAll('.tab-btn').forEach(t => t.classList.remove('active'));
        document.getElementById(view+'-view').classList.add('active-view');
        document.getElementById('tab-'+view).classList.add('active');
    }

    // Stock
    function addNewStock() {
        let id = parseInt(document.getElementById('stockItemId').value);
        let qty = parseInt(document.getElementById('stockQty').value);
        let item = inventory.find(i => i.id === id);
        
        if(item) {
            item.stock += qty;
            showCustomAlert("‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∂∫‡∑í", "‡∑É‡∑ä‡∂ß‡∑ú‡∂ö‡∑ä ‡∂∫‡∑è‡∑Ä‡∂≠‡∑ä‡∂ö‡∑è‡∂Ω‡∑ì‡∂± ‡∑Ä‡∑í‡∂∫.");
        } else {
            inventory.push({
                id: id,
                name: document.getElementById('stockItemName').value,
                price: parseFloat(document.getElementById('stockPrice').value),
                cost: parseFloat(document.getElementById('stockCost').value),
                stock: qty
            });
            showCustomAlert("‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∂∫‡∑í", "‡∂±‡∑Ä ‡∂∑‡∑è‡∂´‡∑ä‡∂©‡∂∫ ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∑Ä‡∑í‡∂∫.");
        }
        localStorage.setItem('chandana_db', JSON.stringify(inventory));
        renderTable();
    }

    // Settings
    function clearData() { if(confirm("‡∑É‡∑í‡∂∫‡∂Ω‡∑î‡∂∏ ‡∂Ø‡∂≠‡∑ä‡∂≠ ‡∂∏‡∑ê‡∂ö‡∑ì‡∂∏‡∂ß ‡∂Ö‡∑Ä‡∑Å‡∑ä‚Äç‡∂∫‡∂Ø?")) { localStorage.clear(); location.reload(); } }

</script>
</body>
</html>
